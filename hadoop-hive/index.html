<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Gatech CSE big data bootcamp">
    <title>Apache Hive - Bigdata Bootcamp</title>

    <link rel="canonical" href="http://bigdata.manul.io/hadoop-hive/">
    <!-- favicon -->
    <link rel="icon" type="image/png" sizes="100x60" href="/image/favicon.png">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/bigdata-bootcamp.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- TOC -->
    <link rel="stylesheet" href="/css/jquery.tocify.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Bigdata Bootcamp</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
<!--                 <li>
                    <a href="/">Home</a>
                </li> -->
                <li>
                    <a href="/contact/">Contact us</a>
                </li>
<!--                 <li>
                    <a href="/spark/">Spark</a>
                </li> -->
<!--                 <li>
                    <a href="/hadoop/">Hadoop</a>
                </li> -->
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li>
                    <a href="/">Home</a>
                </li>
<!--                 <li>
                    <a href="/about/">About</a>
                </li> -->
                <li>
                    <a href="/hadoop/">Hadoop</a>
                </li>
                <li>
                    <a href="/spark/">Spark</a>
                </li>
                <li><a href="/environment/">Environment</a></li>
                <li><a href="/data/">Data</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Page Header -->
<header class="intro-header" style="background-image: url('/image/background.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading" style="padding: 100px 0px 50px 0px">
                    <h1>Apache Hive</h1>
                    <hr class="small">
                    <span class="subheading">Georgia Tech big data bootcamp training material</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<div class="container">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <p>This section shows the basic usage of Hadoop Hive. Hive provides SQL like language HiveQL on top of Hadoop. Instead of writing raw MapReduce program, you can work on data warehouse task using simple farmiliar query language.</p>

<h1 id="interactive-shell">Interactive shell</h1>

<p>In the sample code, we will use the data of patient event sequences in tupel format. Let&#39;s start the Hive CLI interactive shell first by typing <code class="prettyprint">hive</code> in command line</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>hive
...                                                                         
<span class="o">[</span>info]
<span class="gp">hive&gt; </span>
</code></pre></div>
<p>Before loading data, we first need to define a table just like working with database server with SQL.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">hive</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">events</span> <span class="p">(</span>
    <span class="o">&gt;</span>   <span class="n">patient_id</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="o">&gt;</span>   <span class="n">event_name</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="o">&gt;</span>   <span class="n">date_offset</span> <span class="n">INT</span><span class="p">,</span>
    <span class="o">&gt;</span>   <span class="n">value</span> <span class="n">INT</span><span class="p">)</span>
    <span class="o">&gt;</span> <span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span>
    <span class="o">&gt;</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span>
    <span class="o">&gt;</span> <span class="n">STORED</span> <span class="k">AS</span> <span class="n">TEXTFILE</span><span class="p">;</span>
<span class="n">OK</span>
<span class="n">Time</span> <span class="n">taken</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">289</span> <span class="n">seconds</span>
<span class="n">hive</span><span class="o">&gt;</span> 
</code></pre></div>
<p>And we could check existing tables and schema with commands</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">hive</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">TABLES</span><span class="p">;</span>
<span class="n">OK</span>
<span class="n">events</span>
<span class="n">Time</span> <span class="n">taken</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">022</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">Fetched</span><span class="p">:</span> <span class="mi">1</span> <span class="k">row</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">hive</span><span class="o">&gt;</span> <span class="k">DESCRIBE</span> <span class="n">events</span><span class="p">;</span>
<span class="n">OK</span>
<span class="n">patient_id</span>              <span class="n">string</span>                                      
<span class="n">event_name</span>              <span class="n">string</span>                                      
<span class="n">date_offset</span>             <span class="n">int</span>                                         
<span class="n">value</span>                   <span class="n">int</span>                                         
<span class="n">Time</span> <span class="n">taken</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">221</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">Fetched</span><span class="p">:</span> <span class="mi">4</span> <span class="k">row</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</code></pre></div>
<p>Next, let&#39;s insert data into the table.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">hive</span><span class="o">&gt;</span> <span class="k">LOAD</span> <span class="k">DATA</span> <span class="k">LOCAL</span> <span class="n">INPATH</span> <span class="s1">'data'</span>
    <span class="o">&gt;</span> <span class="n">OVERWRITE</span> <span class="k">INTO</span> <span class="k">TABLE</span> <span class="n">events</span><span class="p">;</span>
<span class="n">Loading</span> <span class="k">data</span> <span class="k">to</span> <span class="k">table</span> <span class="k">default</span><span class="p">.</span><span class="n">events</span>
<span class="k">Table</span> <span class="k">default</span><span class="p">.</span><span class="n">events</span> <span class="n">stats</span><span class="p">:</span> <span class="p">[</span><span class="n">numFiles</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">numRows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">1208972</span><span class="p">,</span> <span class="n">rawDataSize</span><span class="o">=</span><span class="mi">0</span><span class="p">]</span>
<span class="n">OK</span>
<span class="n">Time</span> <span class="n">taken</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">521</span> <span class="n">seconds</span>
</code></pre></div>
<p>Then we could run SQL we are farmiliar with like</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">hive</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">patient_id</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">events</span>
    <span class="o">&gt;</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">patient_id</span><span class="p">;</span>

<span class="p">[</span><span class="n">info</span><span class="p">]...</span>

<span class="n">F49EA945C42543C8</span>        <span class="mi">19</span>
<span class="n">F4C0BFF334226C29</span>        <span class="mi">60</span>
<span class="n">F560829E559E1FEB</span>        <span class="mi">13</span>
<span class="p">...</span>
<span class="n">FA4854797F48D537</span>        <span class="mi">88</span>
<span class="n">FA831739B546F976</span>        <span class="mi">15</span>
<span class="n">FAEF9F6E7AF1D99D</span>        <span class="mi">196</span>
<span class="n">FBF4F34C7437373D</span>        <span class="mi">119</span>
<span class="n">FBFD014814507B5C</span>        <span class="mi">28</span>
<span class="n">Time</span> <span class="n">taken</span><span class="p">:</span> <span class="mi">20</span><span class="p">.</span><span class="mi">351</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">Fetched</span><span class="p">:</span> <span class="mi">300</span> <span class="k">row</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</code></pre></div>
<p>We could also save query result to local directory</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">hive</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="n">OVERWRITE</span> <span class="k">LOCAL</span> <span class="n">DIRECTORY</span> <span class="s1">'tmp_local_out'</span>
    <span class="o">&gt;</span> <span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span>
    <span class="o">&gt;</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span>
    <span class="o">&gt;</span> <span class="n">STORED</span> <span class="k">AS</span> <span class="n">TEXTFILE</span>
    <span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">patient_id</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> 
    <span class="o">&gt;</span> <span class="k">FROM</span> <span class="n">events</span> 
    <span class="o">&gt;</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">patient_id</span><span class="p">;</span>


<span class="p">[</span><span class="n">info</span><span class="p">]...</span>
<span class="n">OK</span>
<span class="n">Time</span> <span class="n">taken</span><span class="p">:</span> <span class="mi">17</span><span class="p">.</span><span class="mi">034</span> <span class="n">seconds</span>
</code></pre></div>
<p>You could learn more about the syntax from its <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual">language manual</a>.</p>

<h1 id="besides-shell">Besides shell</h1>

<p>Besides running commands with interactive shell, you can also run a script. In the <code class="prettyprint">sample/hive</code> folder, you can run the entire script with</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">hive -f sample.hql
</code></pre></div>
<p>The content of the script is simply the combination of commands we run in shell with one more statement to drop existing table if necessary</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">events</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">events</span> <span class="p">(</span>
  <span class="n">patient_id</span> <span class="n">STRING</span><span class="p">,</span>
  <span class="n">event_name</span> <span class="n">STRING</span><span class="p">,</span>
  <span class="n">date_offset</span> <span class="n">INT</span><span class="p">,</span>
  <span class="n">value</span> <span class="n">INT</span><span class="p">)</span>
<span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span>
<span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span>
<span class="n">STORED</span> <span class="k">AS</span> <span class="n">TEXTFILE</span><span class="p">;</span>

<span class="k">SHOW</span> <span class="n">TABLES</span><span class="p">;</span>
<span class="k">DESCRIBE</span> <span class="n">events</span><span class="p">;</span>

<span class="k">LOAD</span> <span class="k">DATA</span> <span class="k">LOCAL</span> <span class="n">INPATH</span> <span class="s1">'data'</span>
<span class="n">OVERWRITE</span> <span class="k">INTO</span> <span class="k">TABLE</span> <span class="n">events</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="n">OVERWRITE</span> <span class="k">LOCAL</span> <span class="n">DIRECTORY</span> <span class="s1">'tmp_local_out'</span>
<span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span>
<span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span>
<span class="n">STORED</span> <span class="k">AS</span> <span class="n">TEXTFILE</span>
<span class="k">SELECT</span> <span class="n">patient_id</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> 
<span class="k">FROM</span> <span class="n">events</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">patient_id</span><span class="p">;</span>
</code></pre></div>
<p>Further, it&#39;s possible to run <a href="https://cwiki.apache.org/confluence/display/Hive/HiveServer2+Clients">hive as a server</a> and connect with JDBC or its beeline client.</p>

<h1 id="related-tools">Related tools</h1>

<p>Hive translate queries into a series of MapReduce jobs, thus not suitable for realtime setting. Alternative tools inspired and influeced by Hive are getting more attention, for example, <a href="http://impala.io/">Cloudera Impala</a> and <a href="https://spark.apache.org/sql/">Spark SQL</a>.</p>


            <ul class="pager">
                
  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
    
  
  

  
  

  
  

  
  

  
  

  
  



<li class="previous">
    <a href="/pig/" data-toggle="tooltip" data-placement="top" title="Previous Lesson">&larr; Apache Pig</a>
</li>

                
  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
      
    
  

  
    
    
  

  
    
  

  
    
  

  
    
  

  
    
  



<li class="next">
    <a href="/spark/" data-toggle="tooltip" data-placement="top" title="Next Lesson">Overview of Spark&rarr;</a>
</li>


            </ul>

            <div class="clearfix"></div>

            <hr>
            <!-- disqus -->
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES * * */
                var disqus_shortname = 'sunlabbigdata';
                
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </div>
        <div class="col-lg-2 col-md-1">
            <div id="toc"></div>
        </div>
    </div>
</div>

<hr>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/jimeng" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/cmanul" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/cmanul" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Georgia Institute of Technology 2015. Theme by <a href="https://github.com/IronSummitMedia/startbootstrap-clean-blog-jekyll" target="_blank">Iron Summit Media</a>'s Jekyll version of <a href="http://startbootstrap.com/template-overviews/clean-blog/" target="_blank">Clean Blog</a>.</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- TOC -->
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/jquery.tocify.js"></script>

<!-- ACE Editor -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.0/ace.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/bigdata-bootcamp.js "></script>


</body>

</html>
